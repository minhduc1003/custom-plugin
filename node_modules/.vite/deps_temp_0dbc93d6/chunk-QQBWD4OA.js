import {
  b,
  d,
  f,
  h,
  p,
  v
} from "./chunk-FOWGQH56.js";
import {
  $S,
  Bn,
  E7,
  Fj1,
  Gse,
  H0,
  KD1,
  KU1,
  M2,
  Mo,
  N,
  RS,
  U8,
  VS,
  Vr,
  _,
  ao,
  aq1,
  b0,
  d as d2,
  ene,
  eu,
  f$,
  h1,
  ka,
  lU1,
  nc,
  nn,
  o7t,
  p1,
  pne,
  qse,
  s2e,
  sa,
  t2,
  uSt,
  v11,
  vo,
  yQ,
  ya
} from "./chunk-2ZELARZW.js";
import {
  require_react_dom
} from "./chunk-VGGCA2L5.js";
import {
  require_react
} from "./chunk-73THXJN7.js";
import {
  __toESM
} from "./chunk-2TUXWMP5.js";

// node_modules/lowcoder-sdk/dist/5830a3e5.js
var import_react = __toESM(require_react(), 1);
var import_react_dom = __toESM(require_react_dom(), 1);
nn.extend(KD1);
var je = [eu, ene, pne, v11];
var Oe = {
  value: $S(f, v),
  title: t2(M2, _("comment.titledDefaultValue")),
  placeholder: t2(M2, _("comment.placeholder")),
  buttonText: t2(M2, _("comment.buttonText")),
  sendCommentAble: ao.DEFAULT_TRUE,
  deleteAble: ao,
  userInfo: $S(b, {
    name: "{{currentUser.name}}",
    email: "{{currentUser.email}}"
  }),
  mentionList: $S(d, {
    "@": ["Li Lei", "Han Meimei"],
    "#": ["123", "456", "789"]
  }),
  onEvent: ya(je),
  style: nc(lU1, "style"),
  animationStyle: nc(Fj1, "animationStyle"),
  commentList: aq1("commentList", []),
  deletedItem: aq1("deletedItem", []),
  submitedItem: aq1("submitedItem", []),
  mentionName: Bn("")
};
var Be = (t) => {
  const p2 = (0, import_react.useRef)(null), {
    value: N2,
    dispatch: $,
    style: r,
    title: w,
    sendCommentAble: J,
    buttonText: Q,
    onEvent: He,
    mentionList: y,
    userInfo: X,
    placeholder: Z,
    deleteAble: q,
    animationStyle: b2
  } = t, [P, W] = (0, import_react.useState)([]), [s, x] = (0, import_react.useState)([]), [ee, te] = (0, import_react.useState)("@"), [A, U] = (0, import_react.useState)(""), S = (e) => {
    W(h1.merge(e, {
      "@": h1.union(h1.concat(e["@"], h1.map(s, (o, c) => {
        var h2;
        return (h2 = o == null ? void 0 : o.user) == null ? void 0 : h2.name;
      })))
    }));
  };
  (0, import_react.useEffect)(() => {
    x(N2);
  }, [N2]), (0, import_react.useEffect)(() => {
    S(y);
  }, [y]), (0, import_react.useEffect)(() => {
    t.commentList.onChange(s), S(y), setTimeout(() => {
      p2.current && (p2.current.scrollTop = 999999);
    }, 50);
  }, [s]);
  const ne = (e, o) => {
    te(o);
  }, ae = (e) => {
    var o, c, h2, O, B, H, R, Y, F, z;
    return N(o7t, {
      onClick: () => t.onEvent("click"),
      style: {
        backgroundColor: (o = e == null ? void 0 : e.user) != null && o.avatar ? "" : RS(((c = e == null ? void 0 : e.user) == null ? void 0 : c.displayName) === void 0 ? (h2 = e == null ? void 0 : e.user) == null ? void 0 : h2.name : (O = e == null ? void 0 : e.user) == null ? void 0 : O.displayName)[1],
        verticalAlign: "middle"
      },
      src: (B = e == null ? void 0 : e.user) == null ? void 0 : B.avatar,
      children: [" ", (H = e == null ? void 0 : e.user) != null && H.displayName ? (R = e == null ? void 0 : e.user) == null ? void 0 : R.displayName : /^([\u4e00-\u9fa5]{2,4})$/gi.test((Y = e == null ? void 0 : e.user) == null ? void 0 : Y.name) ? (F = e == null ? void 0 : e.user) == null ? void 0 : F.name.slice(-2) : (z = e == null ? void 0 : e.user) == null ? void 0 : z.name[0]]
    });
  }, oe = (e) => {
    U(e);
  }, j = () => {
    let e = {
      user: X,
      value: A,
      createdAt: nn().format()
    };
    t.submitedItem.onChange(e), x(h1.concat(s, [e])), U(""), S(y), t.onEvent("submit");
  }, le = (e) => {
    let o = h1.cloneDeep(s);
    t.deletedItem.onChange(o.splice(e, 1)), x(o), t.onEvent("delete");
  }, se = (e) => {
    e.shiftKey && (e.preventDefault(), j());
  };
  return d2("div", {
    style: {
      margin: r.margin ?? "3px",
      padding: r.padding ?? "3px",
      width: qse(r.margin ?? "3px"),
      height: Gse(r.margin ?? "3px"),
      background: r.background,
      borderRadius: r.radius,
      animation: b2.animation,
      animationDelay: b2.animationDelay,
      animationDuration: b2.animationDuration,
      animationIterationCount: b2.animationIterationCount
    },
    children: N("div", {
      style: {
        overflow: "auto",
        overflowX: "hidden",
        height: "100%"
      },
      ref: p2,
      children: [d2(yQ, {
        header: w !== "" ? d2("div", {
          style: {
            position: "sticky",
            top: 0,
            background: r.background
          },
          children: s.length > 1 ? w.replaceAll("%d", s.length.toString()).replace("comment", "comments") : w.replaceAll("%d", s.length.toString())
        }) : "",
        size: "small",
        children: d2(f$, {
          data: s,
          itemKey: "createdAt",
          children: (e, o) => {
            var c;
            return d2(yQ.Item, {
              actions: q ? [d2(KU1, {
                style: {
                  color: "#c32230"
                },
                onClick: () => le(o)
              })] : void 0,
              children: d2(yQ.Item.Meta, {
                avatar: ae(e),
                title: N("div", {
                  onClick: () => t.onEvent("click"),
                  children: [d2("a", {
                    children: (c = e == null ? void 0 : e.user) == null ? void 0 : c.name
                  }), d2(Mo, {
                    title: nn(e == null ? void 0 : e.createdAt).isValid() ? nn(e == null ? void 0 : e.createdAt).format("YYYY/M/D HH:mm:ss") : _("comment.dateErr"),
                    placement: "bottom",
                    children: d2("span", {
                      style: {
                        paddingLeft: "5px",
                        color: "#999",
                        fontSize: "11px"
                      },
                      children: nn(e == null ? void 0 : e.createdAt).isValid() ? nn(e == null ? void 0 : e.createdAt).fromNow() : _("comment.dateErr")
                    })
                  })]
                }),
                description: d2("span", {
                  children: e == null ? void 0 : e.value
                })
              })
            }, e == null ? void 0 : e.createdAt);
          }
        })
      }), J ? N("div", {
        style: {
          position: "sticky",
          bottom: 0,
          background: r.background
        },
        children: [d2(uSt, {
          style: {
            width: "100%",
            height: 50
          },
          onSearch: ne,
          prefix: Object.keys(P),
          onChange: oe,
          onSelect: (e) => {
            $(U8("mentionName", e == null ? void 0 : e.value, false)), t.onEvent("mention");
          },
          value: A,
          rows: 2,
          onPressEnter: se,
          placeholder: Z,
          children: (P[ee] || []).map((e, o) => d2(uSt.Option, {
            value: e,
            children: e
          }, o.toString()))
        }), d2(sa, {
          type: "primary",
          style: {
            width: "100%",
            marginTop: "10px"
          },
          onClick: j,
          disabled: A === "",
          children: Q
        })]
      }) : ""]
    })
  });
};
var M = function() {
  return new VS(Oe, (t, p2) => d2(Be, {
    ...t,
    dispatch: p2
  })).setPropertyViewFn((t) => N(p1, {
    children: [d2(ka, {
      name: b0.basic,
      children: t.title.propertyView({
        label: _("comment.title")
      })
    }), ((0, import_react.useContext)(Vr).editorModeStatus === "logic" || (0, import_react.useContext)(Vr).editorModeStatus === "both") && N(p1, {
      children: [N(ka, {
        name: b0.data,
        children: [t.value.propertyView({
          label: _("comment.value"),
          tooltip: p,
          placeholder: "[]"
        }), t.userInfo.propertyView({
          label: _("comment.userInfo"),
          tooltip: h
        }), t.mentionList.propertyView({
          label: _("comment.mentionList"),
          tooltip: _("comment.mentionListDec")
        })]
      }), N(ka, {
        name: b0.interaction,
        children: [t.onEvent.getPropertyView(), E7(t), t.sendCommentAble.propertyView({
          label: _("comment.showSendButton")
        }), t.deleteAble.propertyView({
          label: _("comment.deleteAble")
        })]
      })]
    }), ((0, import_react.useContext)(Vr).editorModeStatus === "layout" || (0, import_react.useContext)(Vr).editorModeStatus === "both") && N(p1, {
      children: [N(ka, {
        name: b0.layout,
        children: [t.sendCommentAble.getView() && t.buttonText.propertyView({
          label: _("comment.buttonTextDec")
        }), t.placeholder.propertyView({
          label: _("comment.placeholderDec")
        })]
      }), d2(ka, {
        name: b0.style,
        children: t.style.getPropertyView()
      }), d2(ka, {
        name: b0.animationStyle,
        hasTooltip: true,
        children: t.animationStyle.getPropertyView()
      })]
    })]
  })).build();
}();
M = class extends M {
  autoHeight() {
    return false;
  }
};
var Ke = H0(M, [new vo("commentList", _("comment.commentList")), new vo("deletedItem", _("comment.deletedItem")), new vo("submitedItem", _("comment.submitedItem")), new vo("mentionName", _("comment.submitedItem")), s2e]);

export {
  Ke
};
//# sourceMappingURL=chunk-QQBWD4OA.js.map
