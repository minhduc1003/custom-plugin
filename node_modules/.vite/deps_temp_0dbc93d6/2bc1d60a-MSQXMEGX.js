import {
  U,
  V
} from "./chunk-OGC7EVZ2.js";
import {
  J,
  K,
  y
} from "./chunk-3MLNRNR6.js";
import {
  AG1,
  Ate,
  HG1,
  Ilr,
  N,
  Pye,
  QDe,
  Qn,
  To,
  U4,
  Vlr,
  W8,
  X8,
  ZPe,
  _,
  a2,
  b3,
  bir,
  cS,
  d,
  de,
  gs,
  iJe,
  kM,
  lir,
  m5,
  p1,
  sZn,
  v9,
  x0r,
  zH,
  zc,
  zr
} from "./chunk-2ZELARZW.js";
import {
  require_react_dom
} from "./chunk-VGGCA2L5.js";
import {
  require_react
} from "./chunk-73THXJN7.js";
import {
  __toESM
} from "./chunk-2TUXWMP5.js";

// node_modules/lowcoder-sdk/dist/2bc1d60a.js
var import_react = __toESM(require_react(), 1);
var import_react_dom = __toESM(require_react_dom(), 1);
var re = de.div`
  display: flex;
  flex-direction: column;
  height: 100%;
  width: 100%;
  min-width: min-content;
`;
var ie = de.div`
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  height: 95px;
  flex-shrink: 0;
  padding: 32px 36px 0 16px;
  border-bottom: 1px solid #e1e3eb;
`;
var oe = de.div`
  display: flex;
  flex-direction: column;

  .taco-edit-text-wrapper {
    width: 252px;
    color: #222222;
    font-size: 18px;
    font-weight: 500;
    margin-left: -8px;

    &:hover {
      background-color: #f5f5f6;
    }
  }

  .taco-edit-text-input {
    width: 252px;
    color: #222222;
    font-weight: 500;
    font-size: 18px;
    background-color: #f5f5f6;
    border: 1px solid #3377ff;
    margin-left: -8px;

    &:focus {
      border-color: #3377ff;
      box-shadow: 0 0 0 2px #d6e4ff;
    }
  }
`;
var ne = de.div`
  display: flex;
  align-items: center;
  gap: 20px;
  font-size: 13px;
  color: #b8b9bf;
`;
var ae = de.div`
  display: flex;
  align-items: center;
  gap: 12px;
`;
var se = de.div`
  position: relative;
  display: flex;
  height: calc(100% - 95px);
  width: 100%;
`;
var de2 = de.div`
  position: relative;
  padding: 16px 16px 80px;
  flex-grow: 1;
  width: calc(100% - 297px);
`;
var le = de.div`
  height: 100%;
  width: 297px;
  display: flex;
  flex-direction: column;
  flex-shrink: 0;
  border-left: 1px solid #e1e3eb;
`;
var ce = (r) => {
  var m;
  const {
    comp: e,
    title: c,
    subTitle: p,
    headerRight: u,
    bodyLeft: h,
    bodyRight: s
  } = r, y2 = e.children.query, l = a2(Vlr), [n, d2] = (0, import_react.useState)();
  return (0, import_react.useEffect)(() => {
    const L = new K(e, (q) => {
      d2((b) => b ? q(b) : void 0);
    });
    d2(L);
  }, []), (0, import_react.useEffect)(() => {
    n != null && n.setComp(() => e);
  }, [e]), n ? d(y.Provider, {
    value: n,
    children: N(re, {
      children: [N(ie, {
        children: [N(oe, {
          children: [c, N(ne, {
            children: [sZn((m = l[y2.children.id.getView()]) == null ? void 0 : m.createTime, 30 * 24 * 60 * 60 * 1e3), p]
          })]
        }), d(ae, {
          children: u
        })]
      }), N(se, {
        children: [d(de2, {
          children: h
        }), d(le, {
          children: s
        })]
      })]
    })
  }) : null;
};
var pe = de(x0r)`
  position: absolute;
  box-shadow: 0 0 10px 0 rgba(0, 0, 0, 0.1);
  border-top: 1px solid #e1e3eb;
  z-index: ${gs.queryResultPanel};
  width: 100%;
  bottom: 0;
  left: 0;
  border-top-left-radius: 8px;
  border-top-right-radius: 8px;

  .react-resizable-handle {
    position: absolute;
    border-top: transparent solid 3px;
    width: 100%;
    padding: 0 3px 3px 0;
    top: 0;
    cursor: row-resize;
  }
`;
var ue = de.div`
  display: flex;
  flex-direction: column;
  height: 100%;
  width: 100%;
  border-top-left-radius: 8px;
  border-top-right-radius: 8px;
`;
var v = (r) => {
  r.preventDefault();
};
var he = () => {
  window.addEventListener("mousedown", v);
};
var ye = () => {
  window.removeEventListener("mousedown", v);
};
var xe = (r) => {
  var l;
  const e = (l = r.comp) == null ? void 0 : l.result(), [c, p] = (0, import_react.useState)(360), {
    header: u,
    body: h
  } = V({
    ...e ?? {
      data: "",
      dataType: "default",
      success: true
    },
    onClose: r.onClose
  });
  if (!e)
    return null;
  const s = document.documentElement.clientHeight, y2 = (n, d2) => {
    p(d2.size.height), ye();
  };
  return d(pe, {
    width: 1 / 0,
    height: c,
    resizeHandles: ["n"],
    minConstraints: [680, 285],
    maxConstraints: [1 / 0, s - 48 - 95],
    onResizeStart: he,
    onResizeStop: y2,
    children: N(ue, {
      children: [d(U, {
        style: {
          cursor: "default"
        },
        children: u
      }), h]
    })
  });
};
var fe = {
  query: Qn(AG1, (r) => d(kM.Provider, {
    value: {
      datasourceId: r.children.datasourceId.getView(),
      disableJSCompletion: true,
      placement: "queryLibrary"
    },
    children: d(HG1, {
      comp: r,
      placement: "queryLibrary"
    })
  })),
  inputs: J
};
var ge = To(fe);
var Qe = class extends ge {
  propertyView(r) {
    return d(me, {
      comp: this,
      onPublish: r.onPublish,
      onHistoryShow: r.onHistoryShow
    });
  }
  getQueryPropertyView() {
    return this.children.query.getPropertyView();
  }
  getRightPropertyView() {
    return N(p1, {
      children: [d(zH, {
        name: _("prop.inputs"),
        width: 296,
        noMargin: true,
        children: this.children.inputs.getPropertyView()
      }, "inputs"), d(zH, {
        name: _("prop.meta"),
        width: 296,
        noMargin: true,
        children: d("div", {
          style: {
            padding: " 0 8px"
          },
          children: d(bir, {
            dataSourceId: this.children.query.children.datasourceId.getView(),
            datasourceType: this.children.query.children.compType.getView()
          })
        })
      }, "meta")]
    });
  }
  nameAndExposingInfo() {
    const r = {};
    return this.children.inputs.getView().forEach((e) => {
      r[e.children.name.getView()] = e.exposingInfo();
    }), r;
  }
};
var me = (r) => {
  const {
    comp: e,
    onPublish: c,
    onHistoryShow: p
  } = r, u = b3(), [h, s] = (0, import_react.useState)(false), y2 = e.children.query.children.datasourceId.getView(), l = iJe(y2);
  (0, import_react.useEffect)(() => {
    s(false);
  }, [e.children.query.children.id.getView()]);
  const n = () => e.children.query.dispatch(W8({
    afterExecFunc: () => s(true)
  }));
  return d(lir.Provider, {
    value: l,
    children: d(v9.Provider, {
      value: Ate(e.nameAndExposingInfo(), false),
      children: d(Pye, {
        global: true,
        keyName: "command+enter",
        onKeyDown: n,
        allowRepeat: true,
        wrapperStyle: {
          width: "100%"
        },
        children: d(ce, {
          comp: e,
          title: d(cS, {
            text: e.children.query.children.name.getView(),
            onFinish: (d2) => d2 !== e.children.query.children.name.getView() && e.dispatch(QDe(e.children.query.children.name.getView(), d2))
          }),
          headerRight: N(p1, {
            children: [d(X8, {
              items: [{
                text: _("queryLibrary.publish"),
                onClick: c
              }, {
                text: _("queryLibrary.historyVersion"),
                onClick: p
              }],
              del: () => U4.confirm({
                title: _("queryLibrary.deleteQueryLabel"),
                content: _("queryLibrary.deleteQueryContent"),
                onConfirm: () => u(Ilr({
                  queryLibraryId: e.children.query.children.id.getView()
                })),
                confirmBtnType: "delete",
                okText: _("delete")
              }),
              children: d(we, {
                children: d(be, {
                  tabIndex: -1
                })
              })
            }), N(Le, {
              onClick: n,
              loading: e.children.query.children.isFetching.getView(),
              buttonType: "primary",
              children: [d(ve, {}), _("queryLibrary.run")]
            })]
          }),
          bodyLeft: N(p1, {
            children: [e.getQueryPropertyView(), h && d(xe, {
              comp: e.children.query,
              onClose: () => s(false)
            })]
          }),
          bodyRight: d(zc, {
            children: e.getRightPropertyView()
          })
        })
      })
    })
  });
};
var be = de(m5)`
  flex-shrink: 0;

  g {
    fill: #8b8fa3;
  }
`;
var we = de.div`
  cursor: pointer;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 32px;
  width: 32px;
  border: 1px solid #d7d9e0;
  border-radius: 4px;

  &:hover {
    background-color: #f5f5f6;
    border: 1px solid #d7d9e0;

    g {
      fill: #222222;
    }
  }
`;
var ve = de(ZPe)`
  transform: rotate(-90deg);
  display: inline-block;
  padding-right: 2px;
  margin-right: 4px;
`;
var Le = de(zr)`
  padding: 0;
  width: 80px;
  height: 32px;
  border: none;

  &:hover {
    padding: 0;
    border: none;
    box-shadow: none;
  }

  &:focus {
    padding: 0;
    border: none;
    box-shadow: none;
  }

  &:after {
    content: "";
  }
`;
export {
  Qe as QueryLibraryComp
};
//# sourceMappingURL=2bc1d60a-MSQXMEGX.js.map
